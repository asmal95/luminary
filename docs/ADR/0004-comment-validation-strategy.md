# ADR-0004: Стратегия валидации комментариев

## Статус
Принято

## Контекст
Каждый сгенерированный комментарий должен быть валидирован перед отправкой в GitLab. Необходимо определить критерии валидации и стратегию обработки невалидных комментариев.

## Решение

### Конфигурируемая валидация
- Валидатор использует LLM (может быть та же модель или более легкая)
- Провайдер валидатора настраивается в конфиге отдельно от основного провайдера
- По умолчанию используется тот же провайдер, что и для генерации

### Критерии валидации:
1. **Релевантность**: Комментарий относится к конкретному коду
2. **Полезность**: Комментарий конструктивен и помогает улучшить код
3. **Не избыточность**: Комментарий не дублирует очевидное, добавляет ценность

### Формат валидации:
- LLM-валидатор получает: исходный код, комментарий, контекст
- Возвращает: boolean (валиден/не валиден) + краткое обоснование

### Обработка невалидных комментариев:
- Невалидные комментарии отклоняются (не отправляются в GitLab)
- Все отклонения логируются с причиной для:
  - Статистики и анализа
  - Отладки и улучшения промптов
  - Будущих улучшений (возможно, переформулировка)

## Последствия

### Положительные:
- Гарантия качества комментариев
- Снижение шума в MR
- Данные для улучшения системы
- Гибкость в выборе модели валидации

### Отрицательные:
- Дополнительные запросы к LLM (увеличение времени и стоимости)
- Возможны false negatives (хорошие комментарии отклоняются)

### Будущие улучшения:
- Машинное обучение на основе логов валидации
- Автоматическая переформулировка отклоненных комментариев
- Fine-tuning промптов на основе статистики
