# ADR-0003: Архитектура провайдеров LLM

## Статус
Принято

## Контекст
Требуется поддержка множества LLM провайдеров: OpenRouter, OpenAI, DeepSeek, VLLM, а также offline моделей (например, Qwen). Система должна быть расширяемой для экспериментов с разными моделями.

## Решение

### Паттерн Strategy + Factory
- Абстрактный базовый класс `LLMProvider` с единым интерфейсом
- Конкретные реализации для каждого провайдера
- Factory для создания провайдеров на основе конфигурации

### Интерфейс провайдера:
```python
class LLMProvider(ABC):
    def __init__(self, config: dict):
        """Инициализация провайдера с валидацией конфигурации"""
        self.config = config
        self._validate_config(config)  # Валидация при создании
    
    def _validate_config(self, config: dict) -> None:
        """Валидация конфигурации. Выбрасывает исключение при ошибке."""
        # Реализация в конкретных провайдерах
        pass
    
    @abstractmethod
    def generate(self, prompt: str, **kwargs) -> str:
        """Генерация ответа от LLM"""
        pass
```

### Поддерживаемые провайдеры (MVP):
1. **OpenRouter** (приоритет #1)
2. **OpenAI**
3. **DeepSeek**
4. **VLLM** (для локальных/offline моделей)

### Конфигурация провайдера:
- Тип провайдера выбирается через конфиг/CLI
- Параметры модели (temperature, max_tokens, top_p) настраиваемы
- API ключи через environment variables
- Валидация конфигурации происходит при инициализации провайдера
- При невалидной конфигурации выбрасывается исключение (не делаем запрос к LLM для проверки)

## Последствия

### Положительные:
- Легкое добавление новых провайдеров
- Единый интерфейс для всех провайдеров
- Возможность экспериментов с разными моделями
- Изоляция логики каждого провайдера
- Валидация конфигурации при инициализации (fail-fast подход)
- Не требуется делать запрос к LLM для проверки конфигурации (экономия времени и средств)

### Отрицательные:
- Необходимость поддержки разных форматов API
- Возможные различия в поведении между провайдерами
- Ошибки конфигурации обнаруживаются только при создании провайдера (но это приемлемо для MVP)
