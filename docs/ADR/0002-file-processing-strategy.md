# ADR-0002: Стратегия обработки файлов

## Статус
Принято

## Контекст
Необходимо определить, как обрабатывать измененные файлы в MR: последовательно или параллельно, как группировать изменения внутри файла.

## Решение

### Последовательная обработка (MVP)
- Файлы обрабатываются последовательно, один за другим
- Изменения внутри файла группируются в один запрос к LLM
- Архитектура позволяет миграцию на параллельную обработку в будущем

### Группировка изменений
- Все изменения (hunks) в одном файле анализируются вместе в одном контексте
- LLM получает полный контекст файла + все изменения
- Комментарии привязываются к конкретным строкам/патчам на основе анализа ответа LLM

### Обработка ошибок
- При ошибках от удаленного сервера (LLM/GitLab API) применяется retry с экспоненциальным backoff
- Максимум 3 попытки
- Логирование всех ошибок для анализа

## Последствия

### Положительные:
- Простота реализации для MVP
- Меньше нагрузка на API (нет параллельных запросов)
- Полный контекст файла для анализа
- Возможность миграции на параллельность без изменения интерфейсов

### Отрицательные:
- Медленнее для больших MR (но приемлемо для MVP)
- Один большой файл может замедлить весь процесс

### Миграция на параллельность:
- Добавить пул потоков/процессов на уровне Application Layer
- Сохранить интерфейсы Domain Layer без изменений
