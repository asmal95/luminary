# Luminary - AI Code Reviewer ะดะปั GitLab

ะะฝัะตะปะปะตะบััะฐะปัะฝัะน ัะตะฒััะตั ะบะพะดะฐ ะฝะฐ ะพัะฝะพะฒะต LLM ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ะฐะฝะฐะปะธะทะฐ Merge Requests ะฒ GitLab.

## ๐ฏ ะะธะดะตะฝะธะต ะฟัะพะตะบัะฐ

ะะฐะทะฒะธัะธะต ะพั ะธะฝััััะผะตะฝัะฐ ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ัะตะฒัั ะบะพะดะฐ ะดะพ ะฟะพะปะฝะพัะตะฝะฝะพะณะพ AI-ะฐะณะตะฝัะฐ, ัะฟะพัะพะฑะฝะพะณะพ ะฝะต ัะพะปัะบะพ ะฝะฐัะพะดะธัั ะฟัะพะฑะปะตะผั, ะฝะพ ะธ ะฟัะตะดะปะฐะณะฐัั ัะปัััะตะฝะธั, ะพะฑัััะฝััั ัะตัะตะฝะธั ะธ ะพะฑััะฐัััั ะฝะฐ ะพัะฝะพะฒะต ะพะฑัะฐัะฝะพะน ัะฒัะทะธ.

**ะขะตะบััะฐั ัะฐะทะฐ:** MVP ัะฐะทัะฐะฑะพัะบะฐ - ะญัะฐะฟ 4 โ

## ๐ ะะพะทะผะพะถะฝะพััะธ (MVP)

- โ ะะฒัะพะผะฐัะธัะตัะบะธะน ะฐะฝะฐะปะธะท ะธะทะผะตะฝะตะฝะธะน ะฒ Merge Request
- โ ะะตะฝะตัะฐัะธั inline-ะบะพะผะผะตะฝัะฐัะธะตะฒ ะบ ะบะพะดั
- โ ะะฐะปะธะดะฐัะธั ะบะพะผะผะตะฝัะฐัะธะตะฒ ะฟะตัะตะด ะพัะฟัะฐะฒะบะพะน
- โ ะะพะดะดะตัะถะบะฐ ะผะฝะพะถะตััะฒะตะฝะฝัั LLM ะฟัะพะฒะฐะนะดะตัะพะฒ (OpenRouter, OpenAI, DeepSeek, VLLM)
- โ ะะธะฑะบะฐั ะบะพะฝัะธะณััะฐัะธั ัะตัะตะท `.ai-reviewer.yml`
- โ ะคะธะปัััะฐัะธั ะฑะธะฝะฐัะฝัั ะธ ัะปัะถะตะฑะฝัั ัะฐะนะปะพะฒ
- โ Retry ัััะฐัะตะณะธั ะดะปั ัััะพะนัะธะฒะพััะธ ะบ ะพัะธะฑะบะฐะผ
- โ ะะพะดะดะตัะถะบะฐ markdown ะฒ ะบะพะผะผะตะฝัะฐัะธัั
- โ ะฃัะพะฒะฝะธ severity (info, warning, error)

## ๐ ะัััััะน ััะฐัั

### ะฃััะฐะฝะพะฒะบะฐ

ะัะพะตะบั ะฟะพะดะดะตัะถะธะฒะฐะตั ัััะฐะฝะพะฒะบั ัะตัะตะท `pip` (ัะดะพะฑะฝะพ ะดะปั Windows) ะธ ัะตัะตะท [uv](https://github.com/astral-sh/uv).

```bash
# ะฃััะฐะฝะพะฒะบะฐ (pip, editable)
python -m pip install -e .
```

### ะัะฟะพะปัะทะพะฒะฐะฝะธะต

```bash
# ะะฝะฐะปะธะท ะพะดะฝะพะณะพ ัะฐะนะปะฐ (mock ะฟะพ ัะผะพะปัะฐะฝะธั)
luminary file path/to/file.py

# ะฏะฒะฝัะน ะฒัะฑะพั ะฟัะพะฒะฐะนะดะตัะฐ
luminary file path/to/file.py --provider openrouter

# ะะตะถะธะผ ะบะพะผะผะตะฝัะฐัะธะตะฒ
luminary file path/to/file.py --comments-mode inline

# ะะตะฒัั MR (GitLab)
luminary mr group/project 123 --no-post
```

### LLM ะฟัะพะฒะฐะนะดะตัั ะธ ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

- **openrouter**: `OPENROUTER_API_KEY`
- **openai**: `OPENAI_API_KEY`
- **deepseek**: `DEEPSEEK_API_KEY`
- **vllm** (ะปะพะบะฐะปัะฝัะน OpenAI-compatible ัะตัะฒะตั): `VLLM_API_URL` (ะพะฟัะธะพะฝะฐะปัะฝะพ), `VLLM_API_KEY` (ะพะฟัะธะพะฝะฐะปัะฝะพ)

### ะะพะฝัะธะณััะฐัะธั (ะฟัะธะผะตั `.ai-reviewer.yml`)

```yaml
llm:
  provider: openrouter  # mock | openrouter | openai | deepseek | vllm
  model: anthropic/claude-3.5-sonnet
  temperature: 0.7
  max_tokens: 2000
  top_p: 0.9

validator:
  enabled: true
  provider: openrouter
  model: anthropic/claude-3-haiku
  threshold: 0.7

comments:
  mode: both  # inline | summary | both

limits:
  max_context_tokens: 8000
  chunk_overlap_size: 200

retry:
  max_attempts: 3
  initial_delay: 1
  backoff_multiplier: 2

prompts:
  review: |
    ... custom review prompt ...
  validation: |
    ... custom validation prompt ...
```

## ๐ณ Docker

ะกะฑะพัะบะฐ ะพะฑัะฐะทะฐ:

```bash
docker build -t luminary:local .
```

ะัะธะผะตั ะทะฐะฟััะบะฐ (ัะตะฒัั ัะฐะนะปะฐ):

```bash
docker run --rm -v "%cd%:/work" -w /work luminary:local file examples/sample_code.py --provider mock
```

ะัะธะผะตั ะทะฐะฟััะบะฐ (ัะตะฒัั MR):

```bash
docker run --rm ^
  -e GITLAB_TOKEN=... ^
  -e OPENROUTER_API_KEY=... ^
  luminary:local mr group/project 123
```

## ๐ค GitLab CI

ะ ัะตะฟะพะทะธัะพัะธะธ ะตััั ะฟัะธะผะตั `.gitlab-ci.yml`, ะบะพัะพััะน:
- ะทะฐะฟััะบะฐะตั ัะตััั
- ะทะฐะฟััะบะฐะตั `luminary mr ...` ะฒ MR pipeline (ะฟัะธ ะฝะฐะปะธัะธะธ `CI_MERGE_REQUEST_IID`)

ะกะตะบัะตัั ัะตะบะพะผะตะฝะดัะตััั ััะฐะฝะธัั ะบะฐะบ GitLab CI variables:
- `GITLAB_TOKEN`
- `OPENROUTER_API_KEY` / `OPENAI_API_KEY` / `DEEPSEEK_API_KEY`

## ๐๏ธ ะััะธัะตะบัััะฐ

ะัะพะตะบั ะธัะฟะพะปัะทัะตั ะผะฝะพะณะพัะปะพะนะฝัั ะฐััะธัะตะบัััั:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Presentation Layer (CLI)          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ   Application Layer (Orchestration) โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ   Domain Layer (Business Logic)     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ   Infrastructure Layer (External)   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
luminary/
โโโ src/luminary/
โ   โโโ domain/           # ะะธะทะฝะตั-ะปะพะณะธะบะฐ ะธ ะผะพะดะตะปะธ
โ   โโโ application/      # ะัะบะตัััะฐัะธั (ัะตัะฒะธัั)
โ   โโโ infrastructure/   # ะะฝะตัะฝะธะต ะธะฝัะตะณัะฐัะธะธ (GitLab, LLM)
โ   โโโ presentation/     # CLI ะธะฝัะตััะตะนั
โโโ docs/                 # ะะพะบัะผะตะฝัะฐัะธั
โโโ tests/                # ะขะตััั
```

## ๐ ะะพะบัะผะตะฝัะฐัะธั

- [Roadmap](ROADMAP.md) - ะดะตัะฐะปัะฝัะน ะฟะปะฐะฝ ัะฐะทัะฐะฑะพัะบะธ
- [ADR ะดะพะบัะผะตะฝัั](docs/ADR/) - ะฐััะธัะตะบัััะฝัะต ัะตัะตะฝะธั
- [ะััะธัะตะบัััะฝะพะต ัะตะทัะผะต](docs/ARCHITECTURE_SUMMARY.md)

## ๐๏ธ ะะฐะทัะฐะฑะพัะบะฐ

### ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน ะดะปั ัะฐะทัะฐะฑะพัะบะธ

```bash
python -m pip install -e ".[dev]"
```

### ะะฐะฟััะบ ัะตััะพะฒ

```bash
python -m pytest
```

### ะคะพัะผะฐัะธัะพะฒะฐะฝะธะต ะบะพะดะฐ

```bash
uv run black src/
uv run ruff check src/
```

## ๐ ะะธัะตะฝะทะธั

ะะธัะตะฝะทะธั ะฑัะดะตั ะพะฟัะตะดะตะปะตะฝะฐ ะฟะพะทะถะต.
